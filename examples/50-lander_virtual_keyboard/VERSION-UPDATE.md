# Обновление версии для сброса кеша на мобильных устройствах

## Проблема
Мобильные браузеры агрессивно кешируют статические файлы (JS, CSS), что приводит к тому, что пользователи не видят обновления после деплоя.

## Решение
Версионирование файлов через query string параметр `?v=YYYYMMDDXXX`

## Как обновить версию перед деплоем

### 1. Обновите версию в version-check.js
Файл: `version-check.js`
Строка: ~5

```javascript
var CURRENT_VERSION = '20251102001';
```

Измените версию на текущую дату + порядковый номер:
- Формат: `YYYYMMDDXXX`
- Пример: `20251102001` -> `20251102002` (второй деплой за день)

### 2. Обновите версию в index.html (2 места!)
Файл: `index.html`
Строки: ~19, ~23

```html
<script type="text/javascript" src="./version-check.js?v=20251102001"></script>
...
<script type="text/javascript" src="../../engine/loader.js?v=20251102001"></script>
```

### 3. Обновите версию в ClientConfig.js
Файл: `ClientConfig.js`
Строка: ~2

```javascript
var igeVersion = '20251102001';
```

**ВАЖНО:** Версия должна совпадать во ВСЕХ трех файлах!

## Автоматизация (TODO)
В будущем можно создать скрипт для автоматического обновления версии:

```bash
# deploy-version-update.sh
NEW_VERSION=$(date +%Y%m%d001)
sed -i "s/igeVersion = '[0-9]*'/igeVersion = '$NEW_VERSION'/g" ClientConfig.js
sed -i "s/loader.js?v=[0-9]*/loader.js?v=$NEW_VERSION/g" index.html
```

## Что делает версионирование

1. **Meta-теги в index.html** - запрещают кеширование HTML
2. **Query string `?v=...`** - браузер считает файлы с разными версиями разными файлами
3. **Версия в loader.js** - обновляет движок игры
4. **Версия во всех JS файлах** - обновляет игровую логику

## Проверка
После деплоя:
1. Откройте игру на мобильном устройстве
2. Сделайте Hard Refresh (Chrome Android: Settings > Clear cache)
3. Проверьте в DevTools > Network что файлы загружаются с новой версией
4. Убедитесь что изменения применились

## Первое обновление (для существующих пользователей)

Если пользователи уже открывали игру ДО добавления системы версионирования, им нужно **один раз** очистить кеш вручную:

### Chrome Android:
1. Откройте игру
2. Нажмите на три точки (меню)
3. Settings → Site settings → найдите ваш сайт
4. Storage → Clear & reset
5. Обновите страницу (Pull to refresh)

### Safari iOS:
1. Настройки → Safari → Очистить историю и данные
2. Или: Настройки → Safari → Дополнительно → Данные сайтов → удалить ваш сайт

**После первой очистки** система `version-check.js` будет автоматически обновлять кеш при каждом изменении версии!

## История версий
- `20251102001` - Добавлена система версионирования, обратный отсчет 3-2-1-GO после респавна, автоматическая очистка кеша

